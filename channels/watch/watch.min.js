var continueWatch=null,playerCurrentTime=0,playerPrevTime=0,playerCurrentPercent=0,playerDuration=0,epId=null,epNumber=null,firstLoad=!0;const currentUrl=new URL(window.location.href);var intervalContinueWatchLog=null,initDisqus=!1,clickedLoadComment=!1;const disqusUrl="https://kaido-1.disqus.com/embed.js",keyLsCurrentServer="v2.5_currentServer";function urlGetParamByName(){var a={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,i){a[t]=i}),a}function countViewMovie(){"watch"===page&&void 0===Cookies.get("watched_"+movieId)&&setTimeout(function(){$.post("https://kaido to/ajax/movie/count-view/"+movieId,function(e){Cookies.set("watched_"+movieId,!0,{path:"/",expires:2/24})})},6e4)}function nextEpisode(){var e,t;$(".ep-item.active").is(":last-child")?(e=(t=$(".ep-page-item.active").next()).data("page"),0<t.length&&(t.click(),$("#episodes-page-"+e+" .ep-item").first().click())):0<(t=$(".ep-item.active").next()).length&&t.click()}function prevEpisode(){var e,t;$(".ep-item.active").is(":first-child")?(e=(t=$(".ep-page-item.active").prev()).data("page"),0<t.length&&(t.click(),$("#episodes-page-"+e+" .ep-item").last().click())):0<(t=$(".ep-item.active").prev()).length&&t.click()}function continueWatchLog(){0<playerCurrentTime&&playerCurrentTime!==playerPrevTime&&(playerPrevTime=playerCurrentTime,$.post("https://kaido.to/ajax/continue-watching/log",{movie_id:movieId,episode_id:epId,episode_number:epNumber,time:Math.round(playerCurrentTime),percent:Math.round(playerCurrentPercent),duration:Math.round(playerDuration)},function(e){}))}function loadDisqus(){var e,t,i="anime"===$(".btn-comment-tab.active").data("type")?window.location.origin+window.location.pathname:window.location.href;$(".btn-load-comment").hide(),initDisqus?"undefined"!=typeof DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.url=i}}):(e=document,(t=e.createElement("script")).src=disqusUrl,t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t),initDisqus=!0)}function initContinueWatchingLog(){intervalContinueWatchLog&&clearInterval(intervalContinueWatchLog),intervalContinueWatchLog=setInterval(function(){isLoggedIn&&checkedLogin?continueWatchLog():clearInterval(intervalContinueWatchLog)},1e4)}$(document).ready(function(){var e;$(".btn-comment-tab").click(function(){$(".btn-comment-tab").removeClass("active"),$(this).addClass("active"),loadDisqus()}),$(".btn-load-comment").click(function(){clickedLoadComment=!0,$(this).hide(),loadDisqus()}),0<$(".schedule-alert").length&&(e=new Date($("#schedule-date").data("value").split(" ").join("T")+"Z"),$("#schedule-date").text(e.toLocaleString("en-US"))),countViewMovie(),$.get("https://kaido.to/ajax/episode/list/"+movieId,function(e){var t;e&&e.status&&(continueWatch=e.continueWatch,1<e.totalItems&&($(".block-prev").show(),$(".block-next").show()),$("#episodes-content").html(e.html),"en"!==userSettings.anime_name&&toggleAnimeName("episode"),(0<(e=document.querySelectorAll('.ep-item[data-id="'+urlGetParamByName().ep+'"]')).length?e[0]:continueWatch?0<(e=document.querySelectorAll('.ep-item[data-id="'+continueWatch.episode_id+'"]')).length?e[0]:$(".ss-list").first().find(".ep-item").first():(e=localStorage.getItem("watching."+movieId),t=document.querySelectorAll('.ep-item[data-id="'+e+'"]'),e&&0<t.length?t[0]:$(".ss-list").first().find(".ep-item").first())).click(),0<$(".ep-page-item").length?$(".ep-page-item[data-page="+$(".ep-item.active").parent().data("page")+"]").click():$("#episodes-page-"+$(".ep-item.active").parent().data("page")).show())}),$(".btn-comment-tab").click(function(){$(".btn-comment-tab").removeClass("active"),$(this).addClass("active")}),$(".btn-watch2gether").click(function(e){e.preventDefault(),checkLogin()&&(window.location.href=$(this).attr("href"))}),$(".dt-comment").click(function(){$(window).scrollTo("#comment-block",{duration:300})})});var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventer=window[eventMethod],messageEvent="attachEvent"===eventMethod?"onmessage":"message";function getSources(e){$("#source-guide").empty(),$.get("https://kaido.to/ajax/episode/sources?id="+e,function(e){var t;e&&(e.htmlGuide&&($("#content-guide").removeClass("only-one"),$("#source-guide").html(e.htmlGuide)),""!==e.link)&&(t=e.link,0<=[1,4].indexOf(parseInt(e.server))&&(t+="&autoPlay="+userSettings.auto_play+"&oa="+(userSettings.play_original_audio||0)+"&asi="+userSettings.auto_skip_intro,continueWatch)&&parseInt($(".ep-item.active").data("id"))===continueWatch.episode_id&&(t+="&time="+continueWatch.time),$("#iframe-embed").attr("src",t),$("#iframe-embed").show())})}eventer(messageEvent,function(e){var t,i=e.data||e.message;try{"vidcloud"===(i=JSON.parse(i)).channel&&("complete"===i.event&&1===parseInt(userSettings.auto_next)&&nextEpisode(),"time"===i.event&&(playerCurrentTime=i.time,playerCurrentPercent=i.percent,playerDuration=i.duration),"error"===i.event)&&0<(t=$(".server-item .btn.active").parent().next()).length&&($(".server-item .btn").removeClass("active"),t.find(".btn").addClass("active"),getSources(t.data("id")))}catch(e){}}),$(document).on("click",".ep-page-item",function(){$(".ep-page-item").removeClass("active"),$(".ep-page-item .ic-active").hide(),$(this).addClass("active"),$(this).find(".ic-active").show(),$(".ss-list-min").hide(),$(".ss-list-min").removeClass("active"),$("#episodes-page-"+$(this).data("page")).show(),$("#episodes-page-"+$(this).data("page")).addClass("active"),$("#current-page").text($(this).text().trim())}),$(document).on("click",".ep-item",function(e){e.preventDefault(),playerCurrentTime=0,epId=$(this).data("id"),epNumber=$(this).data("number"),initContinueWatchingLog(),(0<$(".ss-list-min").length?$(".ss-list.active"):$(".ss-list")).scrollTo(`.ep-item[data-id=${epId}]`,{duration:300});var e=$(this).next(),t=JSON.parse($("#syncData").text().trim());t.episode=$(this).data("number"),0<e.length?t.next_episode_url=t.series_url+"?ep="+e.data("id"):t.next_episode_url="",$("#syncData").text(JSON.stringify(t)),localStorage.setItem("watching."+movieId,epId),firstLoad&&currentUrl.search?(firstLoad=!1,history.pushState({},"",window.location.origin+window.location.pathname+currentUrl.search)):history.pushState({},"",window.location.origin+window.location.pathname+"?ep="+epId),$(".ep-item").removeClass("active"),$(this).addClass("active"),$("#cm-episode-number").text($(this).find(".ssli-order").text()),1!==parseInt(userSettings.auto_load_comments)&&!clickedLoadComment||loadDisqus(),$("#servers-content").html('<div class="loading-relative"><div class="loading"><div class="span1"></div><div class="span2"></div><div class="span3"></div></div></div>'),$("#episode-guide").empty(),$("#iframe-embed").hide(),$("#iframe-embed").attr("src",""),$("#embed-loading").show(),$.get("https://kaido.to/ajax/episode/servers?episodeId="+epId,function(e){var t,i;e&&($("#servers-content").html(e.html),$("#content-guide").addClass("only-one"),$("#episode-guide").html(e.htmlGuide),$("#embed-loading").hide(),e=localStorage.getItem("currentSource"),(e=(t=urlGetParamByName().source)?t:e)&&0<$(".servers-"+e).length?(t=localStorage.getItem(keyLsCurrentServer),i=$(".servers-"+e+" .server-item[data-server-id="+t+"]"),(t&&0<i.length?i:$(".servers-"+e+" .server-item").first()).click()):1===parseInt(userSettings.enable_dub)&&(0<$(".servers-mixed").length||0<$(".servers-dub").length)?0<$(".servers-mixed").length?$(".servers-mixed .server-item").first().click():0<$(".servers-dub").length&&$(".servers-dub .server-item").first().click():(0<$(".servers-sub").length?$(".servers-sub .server-item"):$(".server-item")).first().click())})}),$(document).on("click",".server-item",function(e){$(".server-item .btn").removeClass("active"),$(this).find(".btn").addClass("active"),getSources($(this).data("id")),localStorage.setItem("currentSource",$(this).data("type")),localStorage.setItem(keyLsCurrentServer,$(this).data("server-id"))});