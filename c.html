<!DOCTYPE html>
<html>
<head>
  <title>Student Contract Agreement</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; background: #f9f9f9; }
    input, textarea { width: 100%; padding: 10px; margin: 5px 0; }
    canvas { border: 1px solid #ccc; width: 100%; height: 150px; background: white; }
    h2 { border-bottom: 1px solid #aaa; padding-bottom: 5px; margin-top: 30px; }
    .signature-section { margin-bottom: 30px; }
    .student-block { margin-bottom: 25px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 6px; }
    button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
  </style>
</head>
<body>

<div id="contract">
  <h1>üìù Student Contract Agreement</h1>

  <p><b>Date:</b> <input type="date" /></p>

  <h2>üìú Agreement Terms</h2>
  <textarea rows="4" placeholder="Example: Each participant agrees to clean the classroom every Friday."></textarea>

  <h2>‚öñÔ∏è Consequences if Broken</h2>
  <textarea rows="3" placeholder="Example: Anyone who fails owes a treat to all others."></textarea>

  <h2>üë• Participants</h2>
  <div id="students"></div>
  <button onclick="addStudent()">‚ûï Add Student</button>

  <h2>‚úÖ Core Group Approval (Required)</h2>
  <div class="signature-section">
    <p>Member 1 Signature: <canvas id="sigM1"></canvas> <button onclick="clearSig('sigM1')">Clear</button></p>
    <p>Member 2 Signature: <canvas id="sigM2"></canvas> <button onclick="clearSig('sigM2')">Clear</button></p>
    <p>Member 3 Signature: <canvas id="sigM3"></canvas> <button onclick="clearSig('sigM3')">Clear</button></p>
  </div>
</div>

<button onclick="downloadPDF()">üì• Download as PDF</button>

<script>
  const pads = {
    sigM1: new SignaturePad(document.getElementById("sigM1")),
    sigM2: new SignaturePad(document.getElementById("sigM2")),
    sigM3: new SignaturePad(document.getElementById("sigM3")),
  };

  let studentCount = 0;

  function addStudent() {
    const container = document.getElementById("students");
    studentCount++;

    const div = document.createElement("div");
    div.className = "student-block";
    div.innerHTML = `
      <p><b>Student ${studentCount} Name:</b> <input type="text" id="studentName${studentCount}" /></p>
      <p>Signature:</p>
      <canvas id="studentSig${studentCount}"></canvas>
      <button onclick="clearSig('studentSig${studentCount}')">Clear</button>
    `;

    container.appendChild(div);

    // Initialize SignaturePad for this canvas
    const canvas = div.querySelector(`#studentSig${studentCount}`);
    pads[`studentSig${studentCount}`] = new SignaturePad(canvas);
  }

  function clearSig(id) {
    pads[id]?.clear();
  }

  function downloadPDF() {
    // Convert all canvases to images before generating PDF
    Object.entries(pads).forEach(([id, pad]) => {
      const canvas = pad.canvas;
      const img = document.createElement("img");
      if (!pad.isEmpty()) {
        img.src = pad.toDataURL();
        img.style.width = "100%";
        img.style.border = "1px solid #ccc";
        canvas.replaceWith(img); // Replace canvas with static image
      }
    });

    html2pdf().set({
      margin: 10,
      filename: 'Student_Contract_With_Signatures.pdf',
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    }).from(document.getElementById("contract")).save();
  }
</script>

</body>
</html>
