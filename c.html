<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Contract Agreement</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
      max-width: 900px;
      margin: auto;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    canvas {
      width: 100%;
      height: 150px;
      border: 1px solid #999;
      border-radius: 4px;
      background: white;
    }
    .signature-section, .student-block {
      margin-bottom: 30px;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    h1, h2 {
      color: #333;
    }
    button {
      padding: 10px 20px;
      margin: 10px 0;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }
    .remove-btn {
      background: #dc3545;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div id="contract">
  <h1>ğŸ“ Student Contract Agreement</h1>

  <label>Date:</label>
  <input type="date" />

  <h2>ğŸ“œ Agreement Terms</h2>
  <textarea placeholder="Example: All participants agree to complete their assigned roles on the project."></textarea>

  <h2>âš–ï¸ Consequences if Broken</h2>
  <textarea placeholder="Example: Any student who breaks the contract must give everyone a treat."></textarea>

  <h2>ğŸ‘¥ Contracting Students</h2>
  <div id="students"></div>
  <button onclick="addStudent()">â• Add Student</button>

  <h2>âœ… Core Group Approval</h2>
  <div class="signature-section">
    <label>Member 1 Signature:</label>
    <canvas id="sigM1"></canvas>
    <button onclick="clearSig('sigM1')">Clear</button>

    <label>Member 2 Signature:</label>
    <canvas id="sigM2"></canvas>
    <button onclick="clearSig('sigM2')">Clear</button>

    <label>Member 3 Signature:</label>
    <canvas id="sigM3"></canvas>
    <button onclick="clearSig('sigM3')">Clear</button>
  </div>
</div>

<button onclick="downloadPDF()">ğŸ“¥ Download as PDF</button>

<script>
  const pads = {};
  let studentCount = 0;

  function resizeCanvas(canvas) {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
  }

  function addStudent() {
    studentCount++;
    const id = `student${studentCount}`;
    const container = document.createElement("div");
    container.className = "student-block";
    container.innerHTML = `
      <label>Student ${studentCount} Name:</label>
      <input type="text" id="${id}_name" placeholder="Enter name" />
      <label>Signature:</label>
      <canvas id="${id}_sig"></canvas>
      <button onclick="clearSig('${id}_sig')">Clear</button>
      <button class="remove-btn" onclick="this.parentElement.remove()">âŒ Remove Student</button>
    `;
    document.getElementById("students").appendChild(container);

    const canvas = container.querySelector("canvas");
    resizeCanvas(canvas);
    pads[`${id}_sig`] = new SignaturePad(canvas);
  }

  function clearSig(id) {
    pads[id]?.clear();
  }

  function downloadPDF() {
    // Convert all signature pads to images before saving
    Object.entries(pads).forEach(([id, pad]) => {
      const canvas = pad.canvas;
      if (!pad.isEmpty()) {
        const img = document.createElement("img");
        img.src = pad.toDataURL();
        img.style.width = "100%";
        img.style.border = "1px solid #ccc";
        canvas.replaceWith(img);
      }
    });

    html2pdf().set({
      margin: 10,
      filename: 'Student_Contract_Agreement.pdf',
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    }).from(document.getElementById("contract")).save();
  }

  // Initialize core group signature pads with resizing
  ["sigM1", "sigM2", "sigM3"].forEach(id => {
    const canvas = document.getElementById(id);
    resizeCanvas(canvas);
    pads[id] = new SignaturePad(canvas);
  });
</script>

</body>
</html>
